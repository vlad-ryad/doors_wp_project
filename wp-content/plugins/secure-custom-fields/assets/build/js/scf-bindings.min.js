(()=>{"use strict";const e=window.wp.blocks,t=window.wp.coreData;(0,e.registerBlockBindingsSource)({name:"acf/field",label:"SCF Fields",getValues({context:e,bindings:r,select:n}){const{getEditedEntityRecord:a}=n(t.store),o=(e=>{if(!e?.acf)return{};const t={};return Object.entries(e.acf).forEach(([e,r])=>{if(e.endsWith("_source")){const n=e.replace("_source","");t[n]=r}}),t})(e?.postType&&e?.postId?a("postType",e.postType,e.postId):void 0),c={};return Object.entries(r).forEach(([e,{args:t}={}])=>{const r=((e,t,r)=>{const n=t?.key,a=r[n];if(!a)return"";const o=a.type,c=a.formatted_value;switch(o){case"image":return((e,t)=>{if(!e)return"";switch(t){case"url":return e.url||"";case"alt":return e.alt||"";case"title":return e.title||"";case"id":return e.id||e.ID||"";default:return""}})(c,e);case"checkbox":return Array.isArray(c)?c.join(", "):c?c.toString():"";default:return c?c.toString():""}})(e,t,o);c[e]=r}),c},canUserEditValue:()=>!1});const r=window.wp.element,n=window.wp.hooks,a=window.wp.compose,o=window.wp.blockEditor,c=window.wp.components,l=window.wp.i18n,s=window.wp.data,i=window.wp.editor,u={"core/paragraph":{content:["text","textarea","date_picker","number","range"]},"core/heading":{content:["text","textarea","date_picker","number","range"]},"core/image":{id:["image"],url:["image"],title:["image"],alt:["image"]},"core/button":{url:["url"],text:["text","checkbox","select","date_picker"],linkTarget:["text","checkbox","select"],rel:["text","checkbox","select"]}};const d=(0,a.createHigherOrderComponent)(e=>n=>{const a=function(e){const t=u[e];return t?Object.keys(t):[]}(n.name),{updateBlockBindings:d,removeAllBlockBindings:m}=(0,o.useBlockBindingsUtils)(),f=(0,s.useSelect)(e=>{const{getEditedEntityRecord:r}=e(t.store),{getCurrentPostType:n,getCurrentPostId:a}=e(i.store),o=n(),c=a();if(!o||!c)return{};const l=r("postType",o,c),s={};return Object.entries(l?.acf||{}).forEach(([e,t])=>{if(e.endsWith("_source")){const r=e.replace("_source","");l?.acf.hasOwnProperty(r)&&(s[r]=t)}}),s},[]),p=(0,r.useCallback)((e=null)=>{if(!f||0===Object.keys(f).length)return[];const t=u[n.name];let r=null;return t&&(r=e?t[e]:Object.values(t).flat()),Object.entries(f).filter(([,e])=>!r||r.includes(e.type)).map(([e,t])=>({value:e,label:t.label}))},[f,n.name]),g=(0,r.useMemo)(()=>{if(!a||a.length<=1)return!1;const e=u[n.name];if(!e)return!1;const t=e[a[0]]||[];return a.every(r=>{const n=e[r]||[];return n.length===t.length&&n.every(e=>t.includes(e))})},[a,n.name]),[b,w]=(0,r.useState)({});(0,r.useEffect)(()=>{const e=n.attributes?.metadata?.bindings||{},t={};Object.keys(e).forEach(r=>{e[r]?.args?.key&&(t[r]=e[r].args.key)}),w(t)},[n.attributes?.metadata?.bindings]);const h=(0,r.useCallback)((e,t)=>{if(Array.isArray(e)){const r={...b},n={};e.forEach(e=>{r[e]=t,n[e]=t?{source:"acf/field",args:{key:t}}:void 0}),w(r),d(n)}else w(r=>({...r,[e]:t})),d({[e]:t?{source:"acf/field",args:{key:t}}:void 0})},[b,d]),_=(0,r.useCallback)(()=>{m(),w({})},[m]);return 0!==p().length&&a?0===a.length?React.createElement(e,n):React.createElement(React.Fragment,null,React.createElement(o.InspectorControls,n,React.createElement(c.__experimentalToolsPanel,{label:(0,l.__)("Connect to a field","secure-custom-fields"),resetAll:_},g?React.createElement(c.__experimentalToolsPanelItem,{hasValue:()=>!!b[a[0]],label:(0,l.__)("All attributes","secure-custom-fields"),onDeselect:()=>h(a,null),isShownByDefault:!0},React.createElement(c.ComboboxControl,{label:(0,l.__)("Field","secure-custom-fields"),placeholder:(0,l.__)("Select a field","secure-custom-fields"),options:p(),value:b[a[0]]||"",onChange:e=>h(a,e),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})):a.map(e=>React.createElement(c.__experimentalToolsPanelItem,{key:`scf-field-${e}`,hasValue:()=>!!b[e],label:e,onDeselect:()=>h(e,null),isShownByDefault:!0},React.createElement(c.ComboboxControl,{label:e,placeholder:(0,l.__)("Select a field","secure-custom-fields"),options:p(e),value:b[e]||"",onChange:t=>h(e,t),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}))))),React.createElement(e,n)):React.createElement(e,n)},"withCustomControls");(0,n.addFilter)("editor.BlockEdit","secure-custom-fields/with-custom-controls",d)})();